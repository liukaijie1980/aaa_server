#to run this scrpitï¼š
#docker compose up -d 



services: 
 mysql:
      image: www.netgears.cn:4999/mariadb:ok
      volumes: 
        - ./mariadb01/data:/var/lib/mysql
        - ./mariadb01/etc/my.cnf:/etc/mysql/my.cnf
      ports: 
        - "3306:3306"

      environment:
        MARIADB_ROOT_PASSWORD: 123456

#      healthcheck: 
#        test:  "netstat -antp|grep 3306"
#        interval:  "30s"
#        timeout:  "3s"
#        retries: 1
      restart: always


 backend: 
      depends_on:
        - mysql
      image: www.netgears.cn:4999/java:ok
      volumes: 
        - "/var/run/docker.sock:/var/run/docker.sock"
        - ./java/app:/usr/app
      ports: 
        - "8088:8088"
      expose:
        - "8088"
      restart: always

 api:
      depends_on:
        - mysql
      image: www.netgears.cn:4999/java:ok
      volumes:
        - ./java/api:/usr/app
      ports:
        - "10368:8088"
      restart: always

 boss_bridge:
      depends_on:
        - backend
      build:
        context: ../boss_bridge
        dockerfile: Dockerfile
      image: www.netgears.cn:4999/boss-bridge:ok
      ports:
        - "8090:8090"
      environment:
        RADIUS_API_URL: http://backend:8088
        PORT: "8090"
        ADMIN_USERNAME: admin
        ADMIN_PASSWORD: admin
      restart: always

 frontend: 
      depends_on:
       - backend
      image: www.netgears.cn:4999/nginx:ok
      volumes: 
      - ./nginx/app:/usr/app/dist
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      ports:
      - "80:80"
      restart: always

 radius:
      depends_on:
       - mysql
      image: www.netgears.cn:4999/radius:ok
      volumes:
        - ./radius/radius:/home/radius/radius
      #ports: 
      # - "1812-1813:1812-1813/udp" 
      network_mode: host  
      healthcheck: 
        test:  "netstat -anup|grep 1812"
        interval:  "30s"
        timeout:  "3s"
        retries: 1
      restart: always

 autoheal:
    image: willfarrell/autoheal
    container_name: autoheal
    environment:
      - AUTOHEAL_CONTAINER_LABEL=all
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    restart: always


 portainer:
    image: portainer/portainer
    ports:
      - "0.0.0.0:9000:9000"
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock"
    restart: always


